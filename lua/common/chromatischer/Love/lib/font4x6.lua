-- 4x6 pixel font renderer for game canvas
-- Monospace 4x6 glyphs, 1px gap horizontally
local M = {}

local G = {}
local function glyph(a,b,c,d,e,f)
  return {a,b,c,d,e,f}
end

-- Basic punctuation
G[' '] = glyph("....","....","....","....","....","....")
G['.'] = glyph("....","....","....","....","....","..#.")
G[','] = glyph("....","....","....","....","..#.",".#..")
G['-'] = glyph("....","....",".##.","....","....","....")
G['_'] = glyph("....","....","....","....","....","####")
G['/'] = glyph("...#","..#.","..#.",".#..",".#..","#...")
G[':'] = glyph("....","..#.","....","....","..#.","....")

-- Digits
G['0'] = glyph(".##.","#..#","#..#","#..#","#..#",".##.")
G['1'] = glyph("..#.",".##.","..#.","..#.","..#.",".###")
G['2'] = glyph(".##.","#..#","...#","..#.",".#..","####")
G['3'] = glyph("####","...#",".##.","...#","#..#",".##.")
G['4'] = glyph("...#","..##",".#.#","#..#","####","...#")
G['5'] = glyph("####","#...","###.","...#","...#","###.")
G['6'] = glyph(".###","#...","###.","#..#","#..#",".##.")
G['7'] = glyph("####","...#","..#.",".#..","#...","#...")
G['8'] = glyph(".##.","#..#",".##.","#..#","#..#",".##.")
G['9'] = glyph(".##.","#..#","#..#",".###","...#",".##.")

-- Letters used commonly (uppercase). Unlisted letters fall back.
G['A'] = glyph(".##.","#..#","####","#..#","#..#","#..#")
G['B'] = glyph("###.","#..#","###.","#..#","#..#","###.")
G['C'] = glyph(".###","#...","#...","#...","#...",".###")
G['D'] = glyph("###.","#..#","#..#","#..#","#..#","###.")
G['E'] = glyph("####","#...","###.","#...","#...","####")
G['F'] = glyph("####","#...","###.","#...","#...","#...")
G['G'] = glyph(".###","#...","#...","#.##","#..#",".##.")
G['H'] = glyph("#..#","#..#","####","#..#","#..#","#..#")
G['I'] = glyph("###.",".#..",".#..",".#..",".#..","###.")
G['J'] = glyph(".###","..#.","..#.","..#.","#.#.",".##.")
G['K'] = glyph("#..#","#.#.","##..","#.#.","#.#.","#..#")
G['L'] = glyph("#...","#...","#...","#...","#...","####")
G['M'] = glyph("#..#","####","#..#","#..#","#..#","#..#")
G['N'] = glyph("#..#","##.#","#.#.","#..#","#..#","#..#")
G['O'] = glyph(".##.","#..#","#..#","#..#","#..#",".##.")
G['P'] = glyph("###.","#..#","#..#","###.","#...","#...")
G['Q'] = glyph(".##.","#..#","#..#","#.#.",".##.","...#")
G['R'] = glyph("###.","#..#","#..#","###.","#.#.","#..#")
G['S'] = glyph(".###","#...",".##.","...#","...#","###.")
G['T'] = glyph("####",".#..",".#..",".#..",".#..",".#..")
G['U'] = glyph("#..#","#..#","#..#","#..#","#..#",".##.")
G['V'] = glyph("#..#","#..#","#..#","#..#",".#.#","..#.")
G['W'] = glyph("#..#","#..#","#..#","#..#","####","#..#")
G['X'] = glyph("#..#",".#.#","..#.",".#.#","#..#","#..#")
G['Y'] = glyph("#..#",".#.#","..#.","..#.","..#.","..#.")
G['Z'] = glyph("####","...#","..#.",".#..","#...","####")

local function draw_char(x,y,ch)
  local g = G[ch] or G['?']
  if not g then
    -- fallback '?' glyph
    g = glyph("####","#..#","..#.","..#.","#..#","####")
  end
  for row=1,6 do
    local line = g[row]
    for col=1,4 do
      if line:sub(col,col) == '#' then
        love.graphics.rectangle('fill', x + (col-1), y + (row-1), 1, 1)
      end
    end
  end
end

function M.print(text, x, y)
  local s = tostring(text or "")
  s = s:upper()
  local cx = x
  for i=1,#s do
    local ch = s:sub(i,i)
    draw_char(cx, y, ch)
    cx = cx + 5 -- 4px glyph + 1px spacing
  end
end

return M
